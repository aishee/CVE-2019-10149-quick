#!/bin/bash

LINUX_OS=
rootChecks()
{
  if [[ $EUID -ne 0 ]]; then
    echo  "Please run with root user or using sudo."
    exit 1
  fi
}

checkOSS()
{
  getUname
  LINUX_OS_LOW=$(echo $LINUX_OS)
  case "$LINUX_OS_LOW" in
    *"Ubuntu"* )
      echo "OS is Ubuntu."
      if [[ ! -z $(dpkg -l | grep exim) ]]; then
        echo "Updating for Ubuntu"
        apt-get update >/dev/null 2>&1
        apt-get --yes --force-yes install exim4 exim4-config exim4-daemon-heavy >/dev/null 2>&1
        apt-get --yes --force-yes install --reinstall curl >/dev/null 2>&1
      else
        echo "No exim. Stop now"
        exit 1
      fi
      ;;
    *"Redhat"* )
      echo "OS is Redhat."
      if [[ ! -z  $(rpm -qa | grep exim) ]]; then
        if [[ "$(cat /etc/redhat-release | tr -dc '0-9.'|cut -d \. -f1)" -gt "6" ]]; then

          echo "Working...."
          yum install -y -q -e 0 exim  >/dev/null 2>&1
          yum reinstall -y -q -e 0 curl >/dev/null 2>&1
        else
          echo "Working...."
          yum install -y -q -e 0 exim  >/dev/null 2>&1
          yum reinstall -y -q -e 0 curl >/dev/null 2>&1
        fi
      else
        echo "No exim. Stop now"
        exit 1
      fi
      ;;
    *"Centos"* )
      echo "OS is CentOS."
      if [[ ! -z  $(rpm -qa | grep exim) ]]; then
        if [[ "$(cat /etc/redhat-release | tr -dc '0-9.'|cut -d \. -f1)" -gt "6" ]]; then

          echo "Working...."
          yum install -y -q -e 0 exim  >/dev/null 2>&1
          yum reinstall -y -q -e 0 curl >/dev/null 2>&1
        else
          echo "Working...."
          yum install -y -q -e 0 exim  >/dev/null 2>&1
          yum reinstall -y -q -e 0 curl >/dev/null 2>&1
        fi
      else
        echo "No exim. Stop now"
        exit 1
      fi
      ;;
    *"Darwin"* )
      echo "Not for MacOS"
      exit 1
      ;;
    * )
      echo "OS not supported"
      ;;
  esac
}
getUname()
{
  UNAME=$(uname)
  if [ "$UNAME" == "Linux" ]; then
    if [ -f /etc/lsb-release -o -d /etc/lsb-release.d ]; then
      LINUX_OS=$(lsb_release -i | cut -d: -f2 | sed s/'^\t'//)
    elif [ -f /etc/system-release ]; then
      LINUX_OS=$(cat /etc/system-release  | cut -f 1 -d  " ")
    else
      LINUX_OS=$(ls -d /etc/[A-Za-z]*[_-][rv]e[lr]* | grep -v "lsb" | cut -d'/' -f3 | cut -d'-' -f1 | cut -d'_' -f1)
    fi
  fi
  if [ "$LINUX_OS" == "" ]; then
    LINUX_OS=$(uname)
  fi
}

rootChecks
checkOSS
